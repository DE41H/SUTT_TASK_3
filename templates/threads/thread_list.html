{% extends 'base.html' %}

{% block content %}
<div class="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-8 gap-6">
    <div class="w-full lg:w-auto">
        <h1 class="text-2xl font-bold text-slate-900">{{ category.name }}</h1>
        
        <div class="flex flex-wrap items-center gap-4 mt-2">
            <div class="flex items-center space-x-3">
                <span class="text-xs text-slate-400 font-bold uppercase tracking-wider">Sort By:</span>
                
                <a href="{% url 'threads:thread_list' category.slug '-created_at' %}{% if search_query %}?q={{ search_query }}{% endif %}" 
                   class="text-sm font-medium {% if '-created_at' in request.path %}text-indigo-600 underline underline-offset-4 decoration-2{% else %}text-slate-400 hover:text-slate-600{% endif %}">
                   Latest
                </a>

                <a href="{% url 'threads:thread_list' category.slug '-upvote_count' %}{% if search_query %}?q={{ search_query }}{% endif %}" 
                   class="text-sm font-medium {% if '-upvote_count' in request.path %}text-indigo-600 underline underline-offset-4 decoration-2{% else %}text-slate-400 hover:text-slate-600{% endif %}">
                   Top
                </a>
            </div>

            <form method="GET" action="" class="relative flex-1 min-w-[240px] max-w-md group">
                <i data-lucide="search" class="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-indigo-500 transition-colors"></i>
                
                <input type="text" 
                       name="q" 
                       value="{{ search_query|default:'' }}"
                       placeholder="Search in {{ category.name }}..." 
                       class="w-full pl-10 {% if search_query %}pr-10{% else %}pr-4{% endif %} py-2 bg-slate-100 border-transparent focus:bg-white focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 rounded-lg text-sm transition-all outline-none">
                
                {% if search_query %}
                    <a href="{% url 'threads:thread_list' category.slug '-created_at' %}" 
                       class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 p-1 hover:bg-slate-200 rounded-md transition-colors"
                       title="Clear search">
                        <i data-lucide="x" class="w-4 h-4"></i>
                    </a>
                {% endif %}
            </form>
        </div>
    </div>
    
    <a href="{% url 'threads:thread_create' category.pk %}?next={{ request.get_full_path|urlencode }}" 
       class="bg-indigo-600 hover:bg-indigo-700 text-white px-5 py-2.5 rounded-lg font-semibold flex items-center shadow-sm transition-all active:scale-95 shrink-0">
        <i data-lucide="plus" class="w-4 h-4 mr-2"></i> New Thread
    </a>
</div>

{% if search_query %}
    <div class="mb-6 flex items-center justify-between">
        <p class="text-sm text-slate-500">
            Showing results for <span class="font-bold text-slate-900">"{{ search_query }}"</span>
        </p>
        <span class="text-xs font-semibold text-slate-400 bg-slate-100 px-2 py-1 rounded">
            {{ paginator.count }} match{{ paginator.count|pluralize:"es" }}
        </span>
    </div>
{% endif %}

<div class="space-y-4">
    {% for thread in threads %}
    <div class="bg-white border border-slate-200 rounded-xl p-5 hover:border-slate-300 transition-all shadow-sm">
        <div class="flex items-start gap-4">
            <div class="flex flex-col items-center bg-slate-50 p-2 rounded-lg min-w-[48px]">
                <form action="{% url 'threads:upvote' thread.pk 'thread' %}?next={{ request.get_full_path|urlencode }}" method="POST">
                    {% csrf_token %}
                    <button type="submit" class="text-slate-400 hover:text-indigo-600 transition-colors">
                        <i data-lucide="arrow-big-up" class="w-6 h-6"></i>
                    </button>
                </form>
                <span class="text-sm font-bold text-slate-700">{{ thread.upvote_count }}</span>
            </div>
            
            <div class="flex-1">
                <a href="{% url 'threads:thread_detail' thread.pk '-created_at' %}" class="text-lg font-bold text-slate-900 hover:text-indigo-600 block mb-1">
                    {{ thread.title }}
                </a>
                <p class="text-slate-600 text-sm line-clamp-2 mb-3">
                    {{ thread.content|striptags|truncatewords:40 }}
                </p>
                
                <div class="flex items-center text-xs text-slate-400 space-x-4">
                    <span class="flex items-center">
                        <i data-lucide="user" class="w-3.5 h-3.5 mr-1"></i> {{ thread.author.username }}
                    </span>
                    <span class="flex items-center text-indigo-500 font-medium">
                        <i data-lucide="message-square" class="w-3.5 h-3.5 mr-1"></i> {{ thread.reply_count }} replies
                    </span>
                    <span class="hidden md:inline">{{ thread.created_at|date:"M d, Y" }}</span>
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="text-center py-20 bg-white rounded-xl border-2 border-dashed border-slate-200">
        <div class="w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-4">
            <i data-lucide="{% if search_query %}search-x{% else %}message-circle-off{% endif %}" class="w-8 h-8 text-slate-300"></i>
        </div>
        {% if search_query %}
            <p class="text-slate-500 font-medium">No threads matching "{{ search_query }}"</p>
            <p class="text-sm text-slate-400">Try using broader keywords or checking your spelling.</p>
            <a href="{% url 'threads:thread_list' category.slug '-created_at' %}" class="mt-4 inline-block text-indigo-600 font-semibold hover:text-indigo-700">Clear Search</a>
        {% else %}
            <p class="text-slate-500 font-medium">No threads found in this category yet.</p>
            <p class="text-sm text-slate-400">Be the first to start a conversation!</p>
        {% endif %}
    </div>
    {% endfor %}
</div>

{% if is_paginated %}
<div class="mt-10 flex flex-col items-center border-t border-slate-100 pt-6">
    <div class="flex items-center space-x-2">
        {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}" 
               class="px-4 py-2 bg-white border border-slate-200 rounded-lg text-sm font-medium text-slate-600 hover:bg-slate-50 transition-colors">
                Previous
            </a>
        {% endif %}
        
        <span class="px-4 py-2 text-sm text-slate-500">
            Page <span class="font-bold text-slate-900">{{ page_obj.number }}</span> of {{ page_obj.paginator.num_pages }}
        </span>

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}" 
               class="px-4 py-2 bg-white border border-slate-200 rounded-lg text-sm font-medium text-slate-600 hover:bg-slate-50 transition-colors">
                Next
            </a>
        {% endif %}
    </div>
</div>
{% endif %}

{% endblock %}
